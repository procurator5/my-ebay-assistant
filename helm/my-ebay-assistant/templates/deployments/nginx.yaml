apiVersion: apps/v1
kind: Deployment
metadata:
  {{- with .Values.hooks.nginxannotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  creationTimestamp: null
  labels:
    app: {{ .Values.nginx.name }}
  name: {{ .Values.nginx.name }}
spec:
spec:
  selector:
      matchLabels:
        io.kompose.service: {{ .Values.nginx.name }}
  replicas: {{ .Values.nginx.replicas }}
  strategy: {}
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: {{ .Values.nginx.name. }}
    spec:
      containers:
      - name: {{ .Values.nginx.name }}
        image: nginx
        imagePullPolicy: Always
        ports:
          - containerPort: {{ .Values.nginx.targetPort }}
        lifecycle:
          preStop:
            exec:
              command: ["/usr/sbin/nginx", "-s", "quit"]
        volumeMounts:
          - mountPath: /static
            name: static
          - mountPath: /etc/nginx/nginx.conf
            name: nginx-conf
            subPath: nginx.conf
            readOnly: true
      volumes:
        - name: static
          persistentVolumeClaim:
            claimName: static
        - name: nginx-conf
          configMap:
            name: nginx-conf
      restartPolicy: Always
status: {}
